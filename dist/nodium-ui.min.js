!function e(t,i,n){function s(a,r){if(!i[a]){if(!t[a]){var l="function"==typeof require&&require;if(!r&&l)return l(a,!0);if(o)return o(a,!0);var d=new Error("Cannot find module '"+a+"'");throw d.code="MODULE_NOT_FOUND",d}var h=i[a]={exports:{}};t[a][0].call(h.exports,function(e){var i=t[a][1][e];return s(i?i:e)},h,h.exports,e,t,i,n)}return i[a].exports}for(var o="function"==typeof require&&require,a=0;a<n.length;a++)s(n[a]);return s}({1:[function(e){!function(t){"use strict";e("./nodium-ui")(t.Nodium)}(window)},{"./nodium-ui":2}],2:[function(e,t){t.exports=function(t){var i=t.context,n=i.jQuery,s=i._;t.ui=t.ui||{},e("./ui/UIElement")(t,n),e("./ui/UIPanel")(t,n),e("./ui/PanelContainer")(t,n),e("./ui/List")(t,n),e("./ui/EdgeEditor")(t,n,s),e("./ui/EdgeModePanel")(t,n),e("./ui/NodeEditPanel")(t,n,s),e("./ui/NodeExplorerPanel")(t,n,s),e("./ui/NodeFilterPanel")(t,n,s)}},{"./ui/EdgeEditor":3,"./ui/EdgeModePanel":4,"./ui/List":5,"./ui/NodeEditPanel":6,"./ui/NodeExplorerPanel":7,"./ui/NodeFilterPanel":8,"./ui/PanelContainer":9,"./ui/UIElement":10,"./ui/UIPanel":11}],3:[function(e,t){t.exports=function(e,t){"use strict";var i=e.model,n=e.ui,s=e.util,o=e.event.Event,a=e.event.NodeEvent,r={};n.EdgeEditor=e.createClass({construct:function(e,i,n){this.initialize(e,n),this.options=t.extend({},r,i),this.name="Edge Editor"},init:function(e){var i=this.handleNewPropertyButtonClick.bind(this),n=this.handleDeletePropertyButtonClick.bind(this),s=this.handleNewLabelButtonClick.bind(this),r=this.handleDeleteLabelButtonClick.bind(this);return t(e).on("menu-collapse",this.handleMenuCollapse.bind(this)),this.kernel.on(this,a.SELECTED).on(this,a.UNSELECTED).on(this,a.UPDATED),this.on(this,"#node-form",o.FOCUS_OUT,"textarea").on(this,"#node-form",o.FOCUS_OUT,"input"),t("#new-property",this.view).on(o.CLICK,i),t("#node-form",this.view).on(o.CLICK,".delete-property",n),t("#new-label",this.view).on(o.CLICK,s),t("#node-form",this.view).on(o.CLICK,".delete-label",r),t("#delete-node-button",this.view).on(o.CLICK,this.handleDeleteNodeButtonClick.bind(this)),this},show:function(){var e=t("#node-title",this.view);this["super"]("show"),window.setTimeout(function(){e.focus()},200),t(this.kernel).trigger("mode-change","select")},createProperty:function(){var e,i=t("#node-fields",this.view);e=s.createFromPrototype(i,{field:"",value:"",rows:1}),t("input",t(e).appendTo(i)).focus()},createListElement:function(e,i){var n,o=t(e,this.view);n=s.createFromPrototype(o,i),t("input",t(n).appendTo(o)).focus()},createListElements:function(e,i){var n,o,a=t(e,this.view);for(a.empty(),o=0;o<i.length;o++)n=s.createFromPrototype(a,{label:i[o]}),a.append(n)},destroyListElement:function(e,n){var s=t(e).closest("li"),o=t(".node-key",s).val(),r=new i.Update;s.remove(),"label"===n?r.unsetLabel(o):"property"===n&&r.unsetProperty(o),t(this.kernel).trigger(a.UPDATE,[null,this.nodeData,r])},getLabels:function(){var e,i,n=t("#node-labels").children(),s=[];for(e=0;e<n.length;e++)i=t(".node-label-value",n[e]).val(),""!=i&&s.push(i);return s},getProperties:function(){var e,i,n,s,o=t("#node-fields").children(),a={};for(i in this.exceptions)this.exceptions.hasOwnProperty(i)&&(n=this.exceptions[i],s=t("#"+i).val(),""!=n&&""!=s&&(a[n]=s));for(e=0;e<o.length;e++)n=t(".node-key",o[e]).val(),s=t(".node-value",o[e]).val(),""!=n&&""!=s&&(a[n]=s);return a},updateLabels:function(){var e,n=new i.Update;this.nodeData&&(e=this.getLabels(),n.setLabels(e),t(this.kernel).trigger(a.UPDATE,[null,this.nodeData,n]))},updateProperties:function(){var e,n=new i.Update;this.nodeData&&(e=this.getProperties(),n.setProperties(e),t(this.kernel).trigger(a.UPDATE,[null,this.nodeData,n]))},setData:function(e){var i,n,o,a=t("#node-fields",this.view),r="name";this.nodeData=e||{},o=e._properties[r]||"",t("#node-title",this.view).val(o),a.empty();for(n in e._properties)e._properties.hasOwnProperty(n)&&n!==r&&(i=s.createFromPrototype(a,{field:n,value:e._properties[n],rows:1}),a.append(i));this.createListElements("#node-labels",e._labels)},unsetData:function(){var e=t("#node-fields",this.view),i=t("#node-labels",this.view);t("#node-title",this.view).val(""),e.empty(),i.empty(),this.nodeData=null},handleDeletePropertyButtonClick:function(e){t(e.currentTarget).hasClass("delete-label")||this.destroyListElement(e.currentTarget,"property")},handleDeleteLabelButtonClick:function(e){this.destroyListElement(e.currentTarget,"label")},handleDeleteNodeButtonClick:function(e){e.preventDefault(),e.stopPropagation(),t(this.kernel).trigger(a.DESTROY,[null,this.nodeData])},handleFocusout:function(e){if(t(e.currentTarget).hasClass("node-label-value")){var i=t(e.currentTarget).val();this.updateLabels(i)}else this.updateProperties()},handleNewPropertyButtonClick:function(){this.createListElement("#node-fields",{field:"",value:"",rows:1})},handleNewLabelButtonClick:function(){this.createListElement("#node-labels",{label:""})},handleNodeSelected:function(e,t,i){this.setData(i),this.view.trigger("panel-show",[this])},handleNodeUnselected:function(){this.unsetData(),this.view.trigger("panel-hide",[this])},handleNodeUpdated:function(e,t,i){this.isVisible&&this.nodeData.index===i.index&&this.setData(i)}})}},{}],4:[function(e,t){t.exports=function(e,t){"use strict";var i=e.ui,n=e.event.EdgeEvent,s=e.event.Event,o={};i.EdgeModePanel=e.createClass({construct:function(e,i){this.options=t.extend({},o,e),this.name="Edge mode",this.selector=i,t(i).on(s.CHANGE,"input[type=radio]",this.handleChange.bind(this)),t("input[value=LINK]").click()},handleChange:function(e){var i=e.target,s=t(i).val();t(i).parent().addClass("selected").siblings().removeClass("selected"),t(this.kernel).trigger(n.MODECHANGE,[s])}})}},{}],5:[function(e,t){t.exports=function(e,t){"use strict";var i=(e.model,e.ui),n=e.util,s=e.event.Event;i.List=e.createClass({construct:function(e,i,n){this.selector=e,this.view=i,this.$list=t(this.selector,this.view),t(this.selector).on(s.CLICK,this.handleElementClick.bind(this)),n&&n["delete"]&&t(this.selector,this.view).on(s.CLICK,n["delete"],this.handleDeleteElementButtonClick.bind(this)),n&&n["new"]&&t(n["new"],this.view).on(s.CLICK,_.partialRight(this.handleNewElementButtonClick.bind(this),n.empty))},add:function(e){var i=n.createFromPrototype(this.$list,e);return t(i).appendTo(this.$list)},addAndFocus:function(e,i){console.log(e);var n=this.add(e);return t(i,n).focus(),n},clear:function(){this.$list.empty()},"delete":function(e){var t=this.getItemData(e);return e.remove(),t},deleteByElement:function(e){var e=t(e).closest("li");return this["delete"](e)},get:function(){return _.map(this.$list.children(),this.getItemData,this)},getItemData:function(e){var i=t('input[type="text"], textarea',e);return _.map(i,this.getFieldData,this)},getFieldData:function(e){var i=t(e);return{"class":i.attr("class"),id:i.attr("id"),value:i.val(),data:i.data()}},set:function(e){return this.$list.empty(),e.forEach(this.add,this),this},handleDeleteElementButtonClick:function(e){var i=this.deleteByElement(e.currentTarget);t(this).trigger("list-delete",[i])},handleNewElementButtonClick:function(e,t){this.addAndFocus(t,"input")},handleElementClick:function(e){var i=e.target,n=t(i).closest("li"),s=this.getFieldData(i),o=this.getItemData(n);t(this).trigger("list-click",[s,o])}})}},{}],6:[function(e,t){t.exports=function(e,t,i){"use strict";var n,s=e.ui,o=e.event.Event,a=e.event.EdgeEvent,r=e.event.NodeEvent,l=e.model,d=l.Node,h=s.List;s.NodeEditPanel=e.createClass(s.UIPanel,{construct:function(e,i,s){this.initialize(e,s),this.options=t.extend({},n,i),this.name="Node Editor",this.icon="icon-pencil",this.propertyList=new h("#node-fields","#node-form",{"new":"#new-property","delete":".delete-property",empty:{field:"",value:"",rows:1}}),this.labelList=new h("#node-labels","#node-form",{"new":"#new-label","delete":".delete-label",empty:{label:""}}),this.edgeList=new h("#node-edges","#node-form",{"new":"#new-edge","delete":".delete-edge",empty:{name:""}}),this.explicits={"node-title":"name"}},init:function(e){return t(e).on("menu-collapse",this.handleMenuCollapse.bind(this)),this.kernel.on(this,r.SELECTED).on(this,r.UNSELECTED).on(this,r.UPDATED),t(this.kernel).on(r.LOADED,this.handleGraphLoaded.bind(this)),t(this.kernel).on(a.CREATED,this.handleEdgeCreated.bind(this)),t(this.kernel).on(a.DESTROYED,this.handleEdgeDestroyed.bind(this)),this.on(this,"#node-form",o.FOCUS_OUT,"textarea").on(this,"#node-form",o.FOCUS_OUT,"input"),t(this.labelList).on("list-delete",this.handleDeleteElement.bind(this,"label")),t(this.propertyList).on("list-delete",this.handleDeleteElement.bind(this,"property")),t(this.edgeList).on("list-delete",this.handleDeleteEdge.bind(this)),t(this.edgeList).on("list-click",this.handleEdgeElementClicked.bind(this)),t("#new-edge").on("typeahead:selected",this.handleCreateEdge.bind(this)),t("#delete-node-button",this.view).on(o.CLICK,this.handleDeleteNodeButtonClick.bind(this)),this},getTypeaheadNodes:function(){return this.nodes?this.nodes.filter(function(e){return d.hasProperty(e,"name")}):[]},keyEdgesByNode:function(){var e,t,i,n=d.getId(this.nodeData),s={};this.nodeEdges.forEach(function(o){e=d.getId(o.source),t=d.getId(o.target),n==e?(direction="from",i=t):n==t&&(direction="to",i=e),s.hasOwnProperty(nodeId)||(s[nodeId]=[]),s[nodeId].push({direction:direction,edge:o,other:i})},this)},show:function(){var e=t("#node-title",this.view);this["super"]("show"),window.setTimeout(function(){e.focus()},200),t(this.kernel).trigger("mode-change","select")},unset:function(e,i){var n=new l.Update;"label"===i?n.unsetLabel(e):"property"===i&&n.unsetProperty(e),t(this.kernel).trigger(r.UPDATE,[null,this.nodeData,n])},parseLabel:function(e){return{label:e}},parseProperty:function(e,t){return{field:t,value:e,rows:1}},parseEdge:function(e){if(this.nodeData){var t,i,n=d.getId(this.nodeData),s=e.source,o=e.target,a=d.getId(s)==n;return a?(t=d.getId(o),i=d.getPropertyValue(o,"name")):(t=d.getId(s),i=d.getPropertyValue(s,"name")),{edgeId:e._id,nodeId:t,name:i||"",direction:a?"right":"left"}}},getLabels:function(){var e=this.labelList.get();return i.chain(e).map(i.first).pluck("value").filter(function(e){return""!==e}).valueOf()},getProperties:function(){var e,n,s,o=this.propertyList.get();return s=i.chain(this.explicits).invert().mapValues(function(e){return t("#"+e).val()}).pick(i.identity).valueOf(),i.forEach(o,function(t){e=t[0].value,n=t[1].value,""!=e&&""!=n&&(s[e]=n)}),s},updateLabels:function(){var e=new l.Update;e.setLabels(this.getLabels()),t(this.kernel).trigger(r.UPDATE,[null,this.nodeData,e])},updateProperties:function(){var e=new l.Update;e.setProperties(this.getProperties()),t(this.kernel).trigger(r.UPDATE,[null,this.nodeData,e])},setData:function(e){var n,s,o;this.nodeData=e||{},this.nodeEdges=d.filterEdges(e,this.edges),i.forOwn(this.explicits,function(i,n){var s=d.getPropertyValue(e,i)||"";t("#"+n,this.view).val(s)},this),n=i.map(e._properties,this.parseProperty).filter(function(e){return!i.contains(i.values(this.explicits),e.field)},this),s=i.map(e._labels,this.parseLabel),o=i.map(this.nodeEdges,this.parseEdge,this),this.propertyList.set(n),this.labelList.set(s),this.edgeList.set(o)},unsetData:function(){i.forOwn(this.explicits,function(e,i){t("#"+i,this.view).val("")},this),this.propertyList.clear(),this.labelList.clear(),this.edgeList.clear(),this.nodeData=null,this.nodeEdges=null},handleCreateEdge:function(e,i){this.nodeData&&(t(this.kernel).trigger(a.CREATE,[this.nodeData,i]),console.log("typeahead:selected"),console.log(e))},handleDeleteEdge:function(e,i){var n,s,o=d.getId(this.nodeData),r=i[0].data.nodeid;this.nodeEdges.forEach(function(e,i){n=d.getId(e.source),s=d.getId(e.target),(o==n&&r==s||o==s&&r==n)&&(this.nodeEdges.splice(i,1),t(this.kernel).trigger(a.DESTROY,[e.source,e.target]))},this)},handleDeleteElement:function(e,t,i){var n=i[0].value;n&&this.unset(n,e)},handleDeleteNodeButtonClick:function(e){e.preventDefault(),e.stopPropagation(),t(this.kernel).trigger(r.DESTROY,[null,this.nodeData])},handleEdgeCreated:function(e,t,i,n){!this.nodeData||this.nodeData._id!==i._id&&this.nodeData._id!==n._id||(this.edgeList.add(this.parseEdge({_id:t._id,source:i,target:n})),this.nodeEdges.push(t))},handleEdgeDestroyed:function(e,t){var n,s=t.source,o=t.target;this.nodeEdges=i.reject(this.nodeEdges,function(e){return e.source._id===s._id&&e.target._id===o._id}),this.edgeList.clear(),n=i.map(this.nodeEdges,this.parseEdge,this),this.edgeList.set(n)},handleEdgeElementClicked:function(e,t,i){console.log("Node edit edge element clicked"),console.log(t),console.log(i)},handleFocusout:function(e){if(this.nodeData)if(t(e.currentTarget).hasClass("node-label-value")){var i=t(e.currentTarget).val();this.updateLabels(i)}else this.updateProperties()},handleGraphLoaded:function(e,t,i){console.log("EDIT PANEL GRAPH LOADED"),console.log(t),console.log(i),this.nodes=t,this.edges=i},handleNodeSelected:function(e,t,i){this.setData(i),this.view.trigger("panel-show",[this])},handleNodeUnselected:function(){this.unsetData(),this.view.trigger("panel-hide",[this])},handleNodeUpdated:function(e,t,i){this.isVisible&&this.nodeData.index===i.index&&this.setData(i)}})}},{}],7:[function(e,t){t.exports=function(e,t){"use strict";var i=e.ui,n=(e.event.Event,e.event.NodeEvent,{});i.NodeExplorerPanel=e.createClass(i.UIPanel,{construct:function(e,i,s){this.initialize(e,s),this.options=t.extend({},n,i),this.name="Graph Explorer",this.icon="icon-globe"},init:function(e){return t(e).on("menu-collapse",this.handleMenuCollapse.bind(this)),this},show:function(){this["super"]("show"),t(this.kernel).trigger("mode-change","explorer")}})}},{}],8:[function(e,t){t.exports=function(e,t,i,n){"use strict";var s=e.ui,o=e.util,a=e.event.Event,r=e.event.NodeEvent,l={};s.NodeFilterPanel=e.createClass(s.UIPanel,{construct:function(e,i,n){this.options=t.extend({},l,i),this.view=t(e),this.name="Node Filter",this.icon="icon-filter",this.kernel=n},init:function(e){var n=i.bind(this.handleFilterUnset,this),s=i.bind(this.handleNodeFiltered,this),o=i.bind(this.handleListItemClicked,this);return t(e).on("menu-collapse",this.handleMenuCollapse.bind(this)),t(this.kernel).on(r.FILTER_UNSET,n).on(r.FILTERED,s),t("#node-query",this.view).on([a.INPUT,a.PASTE].join(" "),i.bind(this.handleQueryChange,this)),t(this.view).on(a.CLICK,"li",o),this},show:function(){var e=t("#node-query",this.view);this["super"]("show"),window.setTimeout(function(){e.focus()},200),t(this.kernel).trigger("mode-change","filter")},setData:function(e){var n,s,a,r,l=t("#node-filter-result",this.view),d="name";for(r=i.sortBy(e,d),l.empty(),a=r.length;a>0;a--)s=r[a-1]._properties[d],n=o.createFromPrototype(l,{name:s}),l.prepend(n);this.nodesData=r},unsetData:function(){var e=t("#node-filter-result",this.view);t("#node-query",this.view).val(""),e.empty(),this.nodesData=null},getNodeData:function(e){var i=t("#node-filter-result li",this.view).index(t(e));return this.nodesData[i]},handleListItemClicked:function(e){var i=this.getNodeData(e.currentTarget);t(this.kernel).trigger(r.FILTER_UNSET).trigger(r.SELECT,[n,i])},handleNodeFiltered:function(e,t,i){this.setData(i)},handleFilterUnset:function(){this.unsetData(),this.view.trigger("panel-hide",[this])},handleQueryChange:function(e){this.query=t(e.target).val(),t(this.kernel).trigger(r.FILTER,[this.query])}})}},{}],9:[function(e,t){t.exports=function(e,t){"use strict";var i=e.ui,n=e.util,s={expanded:!1};i.PanelContainer=e.createClass({construct:function(e,i){return this.options=t.extend({},s,i),this.view=t(e),this.panels={},this.isExpanded=this.options.expanded,t(window).on("keydown",this.handleKeyDown.bind(this)),t(this.view).on("panel-show",".panel",this.handlePanelShow.bind(this)).on("panel-hide",".panel",this.handlePanelHide.bind(this)),t(".panel-navigation",this.view).on("click","button",this.handleMenuButtonClicked.bind(this)),this},destroy:function(){},addPanel:function(e){return this.createMenuItem(e.icon),this.panels[e.icon]=e,e.init(this),this},removePanel:function(e){var i=this.panels.indexOf(e);if(-1===i)throw new Error("Could not remove panel.");return this.panels.splice(i,1),t(".panel-navigation ."+e.icon,this.view).remove(),e.destroy(),this},expand:function(e){this.visiblePanel=e,this.panels[e].show(),this.isExpanded||this.view.addClass("expanded"),this.isExpanded=!0},collapse:function(){this.isExpanded&&(this.view.removeClass("expanded"),t(this).trigger("menu-collapse")),this.isExpanded=!1},createMenuItem:function(e){var i,s=t(".panel-navigation",this.view);i=n.createFromPrototype(s,{icon:e}),s.append(i)},handleKeyDown:function(e){27===e.keyCode&&this.collapse()},handleMenuButtonClicked:function(e){this.expand(e.currentTarget.className)},handlePanelShow:function(e,t){this.isExpanded||this.expand(t.icon)},handlePanelHide:function(){this.isExpanded&&this.collapse()}})}},{}],10:[function(e,t){t.exports=function(e,t){"use strict";var i=e.ui,n=e.event.EventAware;i.UIElement=e.createClass(n,{initialize:function(e,i){this.view=t(e),this.kernel=i},resolveSelector:function(e){return e?this.view.find(e):this.view}})}},{}],11:[function(e,t){t.exports=function(e){"use strict";var t=e.ui;t.UIPanel=e.createClass(t.UIElement,{destroy:function(){this.view.remove()},hide:function(){this.isVisible=!1,this.view.removeClass("active")},show:function(){this.isVisible=!0,this.view.addClass("active")},"super":e.util["super"],handleMenuCollapse:function(){this.isVisible&&this.hide()}})}},{}]},{},[1]);